# ============================================
# RELOAD CONFIGURATION
# ============================================
# Unbind the default reload key and rebind to 'r'
# Usage: Ctrl+s then r to reload tmux config
unbind r
bind r source-file ~/.tmux.conf

# ============================================
# SHELL CONFIGURATION
# ============================================
# Set zsh as the default shell for tmux sessions
set-option -g default-shell /bin/zsh

# Enable focus events for better integration with vim/neovim
set-option -g focus-events on

# Enable extended keys for better keyboard support
set-option -g extended-keys on
set-option -g extended-keys-format csi-u

# Detect OS and set default-command accordingly
# On macOS (Darwin), use ARM64 architecture for M1/M2 Macs
if-shell 'uname | grep -q Darwin' "set-option -g default-command 'arch -arch arm64 /bin/zsh'" \
  "set-option -g default-command '/bin/zsh'"

# ============================================
# TERMINAL & COLOR SUPPORT
# ============================================
# Set default terminal to support 256 colors
set -g default-terminal "tmux-256color"

# Enable true color (RGB) support for modern terminals
set -ag terminal-overrides ",xterm-256color:RGB"

# ============================================
# PREFIX KEY
# ============================================
# Change prefix from default Ctrl+b to Ctrl+s (easier to reach)
set -g prefix C-s

# ============================================
# MOUSE SUPPORT
# ============================================
# Enable mouse support for clicking panes, resizing, and scrolling
set -g mouse on

# ============================================
# NEOVIM INTEGRATION
# ============================================
# Allow passthrough for Snacks.nvim to display images in neovim
set -gq allow-passthrough on

# Disable visual activity notifications
set -g visual-activity off

# ============================================
# VI MODE
# ============================================
# Use vi-style key bindings in copy mode
set-window-option -g mode-keys vi

# ============================================
# PANE NAVIGATION (VIM-STYLE)
# ============================================
# Navigate between panes using h/j/k/l (like vim)
# Usage: Ctrl+s then h/j/k/l
bind-key h select-pane -L  # Move to left pane
bind-key j select-pane -D  # Move to pane below
bind-key k select-pane -U  # Move to pane above
bind-key l select-pane -R  # Move to right pane

# Maximize/minimize current pane (toggle zoom)
# Usage: Ctrl+s then m
bind-key m resize-pane -Z

# ============================================
# COPY MODE
# ============================================
# Change copy mode key from default '[' to 'v' (more intuitive)
# Usage: Ctrl+s then v to enter copy mode
unbind-key \[
bind-key 'v' copy-mode

# ============================================
# PANE SPLITTING
# ============================================
# Split panes horizontally with '\' and open in current directory
# Usage: Ctrl+s then \ (creates vertical split)
unbind-key %
bind-key \\ split-window -h -c '#{pane_current_path}'

# Split panes vertically with '-' and open in current directory
# Usage: Ctrl+s then - (creates horizontal split with 10 line height)
unbind-key \"
bind-key - split-window -v -c '#{pane_current_path}' -l 10

# ============================================
# WINDOW MANAGEMENT
# ============================================
# Create new window in current directory instead of home
# Usage: Ctrl+s then c
unbind-key c
bind-key 'c' new-window -c "#{pane_current_path}"

# Reorder windows: move window left/right in tab bar
# Usage: Ctrl+Shift+Left/Right (no prefix needed)
bind-key -n C-S-Left swap-window -t -1 -d
bind-key -n C-S-Right swap-window -t +1 -d

# ============================================
# STATUS BAR
# ============================================
# Position status bar at the top of the screen
set-option -g status-position top

# Configure left side of status bar (empty)
set -g status-left ""
set -g status-left-length 100

# Configure right side of status bar
set -g status-right ""
set -g status-right-length 100
set -g status-right "#{E:@catppuccin_status_application}"
set -agF status-right "#{E:@catppuccin_status_cpu}"
# set -ag status-right "#{E:@catppuccin_status_uptime}"

# ============================================
# CATPPUCCIN THEME CONFIGURATION
# ============================================
# Use Frappe flavor (soft, warm pastel colors)
# Other options: mocha (dark), macchiato (medium), latte (light)
set -g @catppuccin_flavor "frappe"

# Set window status style to rounded corners
set -g @catppuccin_window_status_style "rounded"

# Display current directory name in window tabs (both active and inactive)
# Uses tmux format variable: #{b:pane_current_path} = basename of current path
set -g @catppuccin_window_current_text " #{b:pane_current_path}"
set -g @catppuccin_window_text " #{b:pane_current_path}"
set -g @catppuccin_window_current_fill "all"

# Set status bar background to match terminal background (catppuccin theme)
set -g @catppuccin_status_background "#{@thm_bg}"

# Disable Catppuccin's pane styling to remove the styled box around pane titles
set -g @catppuccin_pane_status_enabled "no"
set -g @catppuccin_pane_border_status "no"

# ============================================
# PANE BORDER STYLING
# ============================================
# Use heavy lines for thicker borders
set -g pane-border-lines heavy

# Enable pane border status line at the top
set -g pane-border-status top

# Show centered running command with spacing (no styled box)
set -g pane-border-format "#[align=centre]#[bold] #{pane_current_command} #[default]"

set-hook -g 'after-new-window' 'run-shell -b "if [ \#{window_panes} -eq 1 ]; then tmux set pane-border-status; fi"'
set-hook -g 'after-kill-pane' 'run-shell -b "if [ \#{window_panes} -eq 1 ]; then tmux set pane-border-status; fi"'
set-hook -g 'after-split-window' 'run-shell -b "if [ \#{window_panes} -gt 1 ]; then tmux set pane-border-status; fi"'

# ============================================
# PLUGINS
# ============================================
# TPM (Tmux Plugin Manager) - manages all plugins
set -g @plugin 'tmux-plugins/tpm'

# Vim-tmux-navigator - seamless navigation between vim and tmux panes
set -g @plugin 'christoomey/vim-tmux-navigator'

# Display nerd font icons in window names
set -g @plugin 'joshmedeski/tmux-nerd-font-window-name'

# Catppuccin theme - beautiful pastel color scheme
set -g @plugin 'catppuccin/tmux#v2.1.3'

# Display CPU usage in status bar
set -g @plugin 'tmux-plugins/tmux-cpu'

# ============================================
# INITIALIZE PLUGINS
# ============================================
# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
